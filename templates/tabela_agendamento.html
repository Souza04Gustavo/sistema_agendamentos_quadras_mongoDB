<!-- Modifica√ß√£o no tabela_agendamento.html - adicionar se√ß√£o de materiais -->

{% extends "layout.html" %}

{% block titulo %}Agendamento - Quadra{% endblock %}

{% block conteudo %}
<h2 style="text-align: center; color: var(--cor-principal); margin-bottom: 20px;">
    Passo 3: Tabela de Hor√°rios - {{ nome_ginasio }}
</h2>

<!-- üÜï NOVA SE√á√ÉO: MATERIAIS DISPON√çVEIS -->
<div style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--cor-principal);">
    <h3 style="color: var(--cor-principal); margin-top: 0;">
        üèê Materiais Esportivos Dispon√≠veis
    </h3>
    
    {% if materiais_disponiveis %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
            {% for material in materiais_disponiveis %}
            <div style="background: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                    <h4 style="margin: 0; color: #333;">{{ material.nome }}</h4>
                    <span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold;">
                        {{ material.qnt_disponivel }} dispon√≠vel{{ 's' if material.qnt_disponivel > 1 }}
                    </span>
                </div>
                
                {% if material.descricao %}
                <p style="margin: 5px 0; color: #666; font-size: 0.9em;">{{ material.descricao }}</p>
                {% endif %}
                
                {% if material.marca %}
                <p style="margin: 5px 0; color: #888; font-size: 0.85em;">
                    <strong>Marca:</strong> {{ material.marca }}
                </p>
                {% endif %}
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                    <span style="background: #17a2b8; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                        Status: {{ material.status }}
                    </span>
                    <small style="color: #6c757d;">Total: {{ material.qnt_total }}</small>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 20px; color: #6c757d;">
            <p style="margin: 0;">üì≠ Nenhum material dispon√≠vel neste gin√°sio no momento.</p>
            <small>Entre em contato com a administra√ß√£o para mais informa√ß√µes.</small>
        </div>
    {% endif %}
</div>

<!-- Navega√ß√£o entre semanas -->
<div style="text-align: center; margin-bottom: 20px;">
    <a href="{{ url_for('tabela_agendamento', ginasio_id=ginasio_id, quadra_id=quadra_id, semana=semana_offset-1) }}" 
       class="btn-semana">‚Üê Semana Anterior</a>
    
    <span style="margin: 0 15px; font-weight: bold;">
        Semana {{ semana_offset + 1 }}
    </span>
    
    <a href="{{ url_for('tabela_agendamento', ginasio_id=ginasio_id, quadra_id=quadra_id, semana=semana_offset+1) }}" 
       class="btn-semana">Pr√≥xima Semana ‚Üí</a>
</div>

<!-- Resto do c√≥digo permanece igual -->
<table border="1" style="width: 100%; border-collapse: collapse; background-color: white;">
    <thead>
        <tr style="background-color: #f2f2f2;">
            <th style="padding: 8px;">Hor√°rio</th>
            {% for dia in dias %}
                <th style="padding: 8px;">{{ dia.strftime("%a") }}<br><small>{{ dia.strftime("%d/%m") }}</small></th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for hora in horarios %}
        <tr>
            <td style="padding: 8px; text-align: center; font-weight: bold;">{{ hora }}</td>
            {% for dia in dias %}
                
                <!-- ======================= IN√çCIO DA CORRE√á√ÉO ======================= -->

                <!-- Acessamos o dicion√°rio usando apenas 'dia', que j√° √© um objeto 'date' -->
                {% set ocupacao = agendamentos_por_dia[dia][hora] %}
                
                <!-- ======================== FIM DA CORRE√á√ÉO ========================= -->
                
                {% if ocupacao %}
                    {# Se existe uma ocupa√ß√£o para este dia/hora #}
                    {% if ocupacao.tipo_ocupacao == 'evento' %}
                        <td style="background-color: #ffc107; color: #333; text-align: center; padding: 8px; font-weight: bold; vertical-align: middle;">
                            {{ ocupacao.nome_evento }}
                        </td>
                    {% else %}
                        <td style="background-color: #add8e6; text-align: center; padding: 8px; vertical-align: middle;">
                            Ocupado
                        </td>
                    {% endif %}
                {% else %}
                    {# Se o hor√°rio est√° livre, mostra o bot√£o para reservar #}
                    <td style="padding: 8px; text-align: center; vertical-align: middle;">
                        <form action="{{ url_for('fazer_agendamento') }}" method="post" style="margin: 0;">
                            <input type="hidden" name="id_ginasio" value="{{ ginasio_id }}">
                            <input type="hidden" name="num_quadra" value="{{ quadra_id }}">
                            <input type="hidden" name="data" value="{{ dia.strftime('%Y-%m-%d') }}">
                            <input type="hidden" name="hora_ini" value="{{ hora }}">
                            <input type="hidden" name="hora_fim" value="{{ '%02d:00'|format((hora[:2]|int + 1) % 24) }}">
                            
                            <button type="submit" 
                                    style="background: var(--cor-principal); 
                                        color: white; 
                                        border: none; 
                                        padding: 5px 10px; 
                                        border-radius: 4px; 
                                        cursor: pointer;">
                                Reservar
                            </button>
                        </form>
                    </td>
                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Campo para reservar para outra pessoa (apenas para bolsistas) -->
{% if session.get('usuario_logado') and session.usuario_logado.eh_bolsista %}
<div style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 8px;">
    <h3>üîÑ Reservar para outra pessoa</h3>
    <form action="{{ url_for('fazer_agendamento_outra_pessoa') }}" method="post">
        <input type="hidden" name="id_ginasio" value="{{ ginasio_id }}">
        <input type="hidden" name="num_quadra" value="{{ quadra_id }}">
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 10px; align-items: end;">
            <div>
                <label><strong>CPF do Usu√°rio:</strong></label>
                <input type="text" name="cpf_usuario" required 
                       placeholder="000.000.000-00"
                       style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
                <label><strong>Data:</strong></label>
                <input type="date" name="data" required 
                       min="{{ dias[0].strftime('%Y-%m-%d') }}" 
                       max="{{ dias[-1].strftime('%Y-%m-%d') }}"
                       style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
                <label><strong>Hora In√≠cio:</strong></label>
                <select name="hora_ini" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">Selecione</option>
                    {% for hora in horarios %}
                    <option value="{{ hora }}">{{ hora }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label><strong>Hora Fim:</strong></label>
                <select name="hora_fim" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">Selecione</option>
                    {% for hora in horarios %}
                    <option value="{{ hora }}">{{ hora }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <button type="submit" 
                        style="background: #28a745; 
                               color: white; 
                               border: none; 
                               padding: 12px 20px; 
                               border-radius: 4px; 
                               cursor: pointer;
                               font-weight: bold;">
                    ‚úÖ Reservar para Outra Pessoa
                </button>
            </div>
        </div>
    </form>
</div>
{% endif %}
<br>

<a href="{{ url_for('selecionar_quadra', ginasio_id=ginasio_id) }}" style="text-decoration: none; font-weight: bold; color: var(--cor-principal);">
    ‚Üê Voltar para a sele√ß√£o de quadras
</a>

<style>
.btn-semana {
    display: inline-block;
    padding: 8px 15px;
    background-color: var(--cor-principal);
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
}

.btn-semana:hover {
    background-color: var(--cor-secundaria);
}

/* üÜï Estilos para a se√ß√£o de materiais */
.material-card {
    background: white;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.material-card:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}